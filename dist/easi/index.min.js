!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e="undefined"!=typeof globalThis?globalThis:e||self).easi=i()}(this,(function(){"use strict";var e,i,n="EasiCustomer/",t="EasiMalaysia/";function a(e,i){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);i&&(t=t.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),n.push.apply(n,t)}return n}function s(e,i){for(var n=0;n<i.length;n++){var t=i[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function o(e,i,n){return i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}(i=e||(e={}))[i.success=0]="success",i[i.cancel=1]="cancel",i[i.fail=2]="fail";var r,c,u,l,p,d=function(i,n,t){switch(null!=n&&n.complete&&n.complete({errMsg:"".concat(t,":complete")}),i.status){case e[0]:(null==n?void 0:n.success)&&(null==n||n.success(function(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?a(Object(n),!0).forEach((function(i){o(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}({errMsg:"".concat(t,":ok")},i.data)));break;case e[1]:(null==n?void 0:n.cancel)&&(null==n||n.cancel({errMsg:"".concat(t,":cancel,").concat(i.message)}));break;case e[2]:(null==n?void 0:n.fail)&&(null==n||n.fail({errMsg:"".concat(t,":fail,").concat(i.message)}))}},h=function(e,i,n,t){!function(e){if(window.WebViewJavascriptBridge)return e(window.WebViewJavascriptBridge);if(document.addEventListener("WebViewJavascriptBridgeReady",(function(){e(window.WebViewJavascriptBridge)}),!1),window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var i=document.createElement("iframe");i.style.display="none",i.src="https://__bridge_loaded__",document.documentElement.appendChild(i),setTimeout((function(){document.documentElement.removeChild(i)}),0)}((function(a){a.callHandler("easi.".concat(e),i,(function(i){"string"==typeof i&&(i=JSON.parse(i)),n&&n(i,t,e)}))}))},f={},g=Object.freeze({__proto__:null,config:function(i){null!=i&&i.debug&&console.log("debug:".concat(JSON.stringify(i))),h("config",{jsApiList:null==i?void 0:i.jsApiList},(function(i){switch(i.status){case e[1]:f.fail&&f.fail({errMsg:i.message||"fail"});break;case e[0]:f.success&&f.success(i.data)}}),i)},ready:function(e){f.success=e},error:function(e){f.fail=e},getNetworkType:function(e){h("getNetworkType",{},d,e)},checkJsApi:function(e){h("checkJsApi",{jsApiList:e.jsApiList},d,e)},updateWechatTimelineShareData:function(e){h("updateWechatTimelineShareData",{title:e.title,link:e.link,imgUrl:e.imgUrl},d,e)},updateWechatMessageShareData:function(e){h("updateWechatMessageShareData",{title:e.title,link:e.link,imgUrl:e.imgUrl,desc:e.desc},d,e)},updateFacebookTimelineShareData:function(e){h("updateFacebookTimelineShareData",{title:e.title,link:e.link,imgUrl:e.imgUrl},d,e)},copy:function(e){h("copy",{content:e.content},d,e)},chooseImage:function(e){h("chooseImage",{accept:e.accept,compressImage:e.compressImage,capture:e.capture,count:e.count},d,e)},getLocalImageData:function(e){h("getLocalImageData",{localId:e.localId},d,e)},previewImage:function(e){h("previewImage",{current:e.current,urls:e.urls},d,e)},openLocation:function(e){h("openLocation",{latitude:e.latitude,longitude:e.longitude,zoom:e.zoom},d,e)},getDeviceLocation:function(e){h("getDeviceLocation",{type:e.type||"wgs84"},d,e)},scanQRCode:function(e){h("scanQRCode",{needContent:e.needContent},d,e)},scanBarcode:function(e){h("scanBarcode",{needContent:e.needContent},d,e)},closeWindow:function(){h("closeWindow")},hideMenuBar:function(){h("hideMenuBar")},showMenuBar:function(){h("showMenuBar")},hideMenuItems:function(e){h("hideMenuItems",{menuItems:e.menuItems},d,e)},showMenuItems:function(e){h("showMenuItems",{menuItems:e.menuItems},d,e)},hideNavBar:function(){h("hideNavBar")},showNavBar:function(){h("showNavBar")},openWebPage:function(e){h("openWebPage",{url:e.url})},openAppPage:function(e){h("openAppPage",{scheme:e.scheme})},getUserInfo:function(e){h("getUserInfo",{},d,e)},showLoading:function(){h("showLoading")},hideLoading:function(){h("hideLoading")}}),m=Object.freeze({__proto__:null,getEASILocation:function(e){h("getEASILocation",{type:e.type},d,e)},showGlobalCart:function(){h("showGlobalCart")},hideGlobalCart:function(){h("hideGlobalCart")},addToCart:function(e){var i;h("addToCart",{itemId:e.itemId,openDetails:null!==(i=e.openDetails)&&void 0!==i&&i},d,e)},removeFromCart:function(e){h("removeFromCart",{itemId:e.itemId},d,e)},addToFavourites:function(e){h("addToFavourites",{shopId:e.shopId},d,e)},removeFromFavourites:function(e){h("removeFromFavourites",{shopId:e.shopId},d,e)},openAppShop:function(e){h("openAppShop",{shopId:e.shopId},d,e)},openAppCoupons:function(){h("openAppCoupons")},openAppAddress:function(){h("openAppAddress")},selectAppAddress:function(e){h("selectAppAddress",{},d,e)},openAppFavourites:function(){h("openAppFavourites")},openAppLanguages:function(e){h("openAppLanguages",{},d,e)},openAppCustomerService:function(){h("openAppCustomerService")},openAppTabBar:function(e){h("openAppTabBar",{id:e.id},d,e)}}),v=new(function(){function e(){!function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),this.SYS_ERROR={code:100,data:"获取数据异常"},this.SYS_VERSION_ERROR={code:100,data:"该Bridge在当前版本不支持，请升级APP"},this.PARAMES_ERROR={code:100,data:"参数错误"},this.SYS_CONFIG={easiAgent:"EasiCustomer/",easiVersion:"1.8.10",easiUserVersion:"1.9.59",easiMalaysiaAgent:"EasiMalaysia/",easiMalaysiaVersion:"4.9.39",easiMalaysiaUserVersion:"4.9.39"},this.appVersion=null,this.ua=navigator.userAgent,this.isEasi=this.ua.includes(this.SYS_CONFIG.easiAgent),this.isMalaysia=this.ua.includes(this.SYS_CONFIG.easiMalaysiaAgent),this.isAndroid=this.ua.includes("Android")||this.ua.includes("android")||this.ua.includes("Linux"),this.isIos=this.ua.includes("iPhone")||this.ua.includes("iOS"),this.version()}var i,n,t;return i=e,(n=[{key:"setupWebViewJavascriptBridge",value:function(e){if(window.WebViewJavascriptBridge)return e(window.WebViewJavascriptBridge);if(document.addEventListener("WebViewJavascriptBridgeReady",(function(){e(window.WebViewJavascriptBridge)}),!1),window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var i=document.createElement("iframe");i.style.display="none",i.src="https://__bridge_loaded__",document.documentElement.appendChild(i),setTimeout((function(){document.documentElement.removeChild(i)}),0)}},{key:"call",value:function(e,i,n){var t=this;this.setupWebViewJavascriptBridge((function(a){t.lowVersionTips(e,i)&&a.callHandler(e,n,(function(e){"string"==typeof e&&(e=JSON.parse(e)),i&&i(e)}))}))}},{key:"lowVersionTips",value:function(e,i){var n=["easi.location","easi.scan","easi.user"];return(!this.isEasi||n.includes(e)||this.compareVersionEle(this.appVersion,this.isAndroid?"2.5.0":"2.4.0"))&&!(this.isMalaysia&&!n.includes(e)&&!this.compareVersionEle(this.appVersion,this.isAndroid?"5.5.0":"5.4.0"))||i(this.SYS_VERSION_ERROR)}},{key:"callMyApp",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.isEasi){if(this.compareVersionEle(this.appVersion,this.SYS_CONFIG.easiVersion))return this.call(e,i,n)}else if(this.isMalaysia&&this.compareVersionEle(this.appVersion,this.SYS_CONFIG.easiMalaysiaVersion))return this.call(e,i,n);return i(this.SYS_ERROR)}},{key:"version",value:function(){var e=this.ua.split(" ");if(e.length>0){var i=this.isMalaysia?this.SYS_CONFIG.easiMalaysiaAgent:this.SYS_CONFIG.easiAgent;e[0].includes(i)&&(this.appVersion=e[0].replace(i,""))}}},{key:"compareVersionEle",value:function(e,i){if(!e||!i)return!1;for(var n=e.split("."),t=i.split("."),a=n.length>t.length?n.length:t.length,s=0;s<a;s++){if(parseInt(n[s])>parseInt(t[s]))return!0;if(parseInt(n[s])<parseInt(t[s]))return!1}return!0}},{key:"getVersion",value:function(e){return this.appVersion?e({code:0,data:this.appVersion}):e(this.SYS_ERROR)}},{key:"getLocation",value:function(e){if(!this.appVersion)return e(this.SYS_ERROR);this.callMyApp("easi.location",e)}},{key:"scan",value:function(e){if(!this.appVersion)return e(this.SYS_ERROR);this.callMyApp("easi.scan",e)}},{key:"user",value:function(e){if(!this.appVersion)return e(this.SYS_ERROR);this.callMyApp("easi.user",e)}},{key:"wx_share",value:function(e,i,n,t){return window.location.href="au.com.easi.customer://share/text?url=".concat(encodeURIComponent(e),"&title=").concat(i,"&text=").concat(n,"&mode=").concat(t,"&channel=1"),!0}},{key:"login",value:function(e){if(!this.appVersion)return e(this.SYS_ERROR);this.callMyApp("easi.login",e)}},{key:"addCart",value:function(e,i){var n=i.itemId,t=void 0===n?null:n,a=i.openDetails,s=void 0===a||a;return this.appVersion?t?(t&&"string"==typeof t&&(t=Number(t)),void this.callMyApp("easi.addCart",e,{itemId:t,openDetails:s})):e(this.PARAMES_ERROR):e(this.SYS_ERROR)}},{key:"showCart",value:function(e,i){var n=i.show,t=void 0!==n&&n;if(!this.appVersion)return e(this.SYS_ERROR);this.callMyApp("easi.showCart",e,{show:t})}},{key:"test",value:function(e){return this.call("easi.test",e,"")}}])&&s(i.prototype,n),t&&s(i,t),e}());return navigator.userAgent.includes("JssdkVersion")?Object.assign(v,(r=navigator.userAgent,c=r.includes(n),u=r.includes(t),l=r.includes("Android")||r.includes("android")||r.includes("Linux"),p=r.includes("iPhone")||r.includes("iOS"),{ua:r,isEasi:c,isMalaysia:u,isAndroid:l,isIos:p,version:function(e){var i=e.ua.split(" ");if(i.length>0){var a=e.isMalaysia?t:n;if(i[0].includes(a))return i[0].replace(a,"")}return null}({ua:r,isMalaysia:u})}),g,m):v}));
